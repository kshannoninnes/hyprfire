{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Hyprfire</title>

    <link rel="stylesheet" href="{% static 'hyprfire_app/page-style.css' %}">
    <link rel="stylesheet" href="{% static 'hyprfire_app/card-style.css' %}">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>

<body>
    <!-- This div will take up 12% of the left side of the screen. -->
    <!-- It is used to display a list of clickable filenames sent by the server -->
    <div class="split left" id="left_container">
        <h3 class="underlinexyz">Analysis</h3>
        <div class="form_thing">
            <form method="POST">
                {% csrf_token %}
                <div class="config_opt"> {{ form.filenames.label }}:{{ form.filenames }}</div>
                <div class="config_opt"> {{ form.window.label }}:{{ form.window }}</div>
                <div class="config_opt"> {{ form.algorithm.label }}:{{ form.algorithm }}</div>
                <div class="config_opt">{{ form.analysis.label }}: {{ form.analysis }}</div>
                <input type="submit" class="w3-btn w3-block hf_btn w3-blue" style="width: 45%" value="Analyse">
            </form>
            <input type="submit" id="exportButton" class="w3-btn w3-block hf_btn w3-green" style="width: 45%; margin-left: 60%; position: absolute; display: inline-block" value="Export">
        </div>

       <h3 class="underlinexyz">Pre-Analysed Files</h3>
       <div class="list_analysed">
           <ul class="w3-ul" id="file_list">
               {% for file in filenames %}
                   <li> {{ file }} </li>
               {% endfor %}
           </ul>
       </div>
    </div>

    <!-- This div takes up the remaining 88% of the right side of the screen. -->
    <!-- It will be used to show a graph and the raw data under the graph -->
    <div class="split right" id="right_container">
        {{ graph|safe }}
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>hehe
    <script type="text/javascript">
      var e = document.getElementById("id_filenames");
      var fileName = e.options[e.selectedIndex].text;
      var myDiv = document.getElementsByClassName('plotly-graph-div')[0];
      var start_time = 0;
      var end_time = 0;
      myDiv.on('plotly_relayout',
      function(data){  
        start_time = data['xaxis.range[0]'];
        end_time = data['xaxis.range[1]'];
        console.log(data['xaxis.range[0]']);
        console.log(data['xaxis.range[1]']);

      });

      $('#exportButton').click(function(event) {
        event.preventDefault();
        $.ajax({
            type: "POST",
            url: "/download/",
            data: JSON.stringify({ 
                'filename': fileName,
                'start': start_time,
                'end': end_time,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            }),
            dataType: 'json',
            success: function(result) {
                alert('export successful');
            },
            error: function(result) {
                alert('error');
            }
        });
    });
    </script>
    <script src="{% static 'hyprfire_app/main.js' %}"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</body>

</html>